@{
    ViewData["Title"] = "Admin Panel";
}

<div class="container py-5">
    <div class="text-center mb-4">
        <h2><i class="bi bi-speedometer2 me-2"></i>Admin Panel</h2>
        <p class="text-muted">Platform istatistikleri ve yonetim</p>
    </div>

    @if (TempData["Success"] is string successMsg)
    {
        <div class="alert alert-success alert-dismissible fade show">
            @successMsg
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }

    <!-- CMS Links -->
    <div class="row g-4 mb-5">
        <div class="col-md-4">
            <a href="/Admin/Videos" class="text-decoration-none">
                <div class="card border-0 shadow-sm card-hover h-100">
                    <div class="card-body p-4 text-center">
                        <i class="bi bi-play-circle text-primary" style="font-size: 2.5rem;"></i>
                        <h5 class="mt-3">Video Yonetimi</h5>
                        <p class="text-muted mb-0">Egitim videolarini ekle, duzenle, sil</p>
                    </div>
                </div>
            </a>
        </div>
        <div class="col-md-4">
            <a href="/Admin/Simulations" class="text-decoration-none">
                <div class="card border-0 shadow-sm card-hover h-100">
                    <div class="card-body p-4 text-center">
                        <i class="bi bi-controller text-success" style="font-size: 2.5rem;"></i>
                        <h5 class="mt-3">Simulasyon Yonetimi</h5>
                        <p class="text-muted mb-0">Interaktif simulasyonlari yonet</p>
                    </div>
                </div>
            </a>
        </div>
        <div class="col-md-4">
            <a href="/Admin/Surveys" class="text-decoration-none">
                <div class="card border-0 shadow-sm card-hover h-100">
                    <div class="card-body p-4 text-center">
                        <i class="bi bi-clipboard-check text-warning" style="font-size: 2.5rem;"></i>
                        <h5 class="mt-3">Anket Yonetimi</h5>
                        <p class="text-muted mb-0">Anketleri olustur ve duzenle</p>
                    </div>
                </div>
            </a>
        </div>
    </div>

    @if (ViewBag.Report is System.Text.Json.JsonElement report)
    {

        <!-- Summary Cards -->
        <div class="row g-4 mb-5">
            <div class="col-md-4">
                <div class="card border-0 shadow-sm bg-primary text-white">
                    <div class="card-body p-4 text-center">
                        <i class="bi bi-people" style="font-size: 2rem;"></i>
                        <h2 class="mt-2">@report.GetProperty("totalUsers").GetInt32()</h2>
                        <p class="mb-0">Toplam Kullanici</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card border-0 shadow-sm bg-success text-white">
                    <div class="card-body p-4 text-center">
                        <i class="bi bi-journal-check" style="font-size: 2rem;"></i>
                        <h2 class="mt-2">@report.GetProperty("totalAttempts").GetInt32()</h2>
                        <p class="mb-0">Toplam Deneme</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card border-0 shadow-sm bg-warning text-dark">
                    <div class="card-body p-4 text-center">
                        <i class="bi bi-graph-up" style="font-size: 2rem;"></i>
                        <h2 class="mt-2">@report.GetProperty("averageScore").GetDouble().ToString("F1")</h2>
                        <p class="mb-0">Ortalama Puan</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Segment Reports -->
        <div class="row g-4">
            <!-- By Age Group -->
            <div class="col-md-6">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-white">
                        <h5 class="mb-0"><i class="bi bi-people me-2"></i>Yas Grubuna Gore</h5>
                    </div>
                    <div class="card-body">
                        <table class="table table-hover mb-0">
                            <thead>
                                <tr>
                                    <th>Segment</th>
                                    <th>Kullanici</th>
                                    <th>Deneme</th>
                                    <th>Ort. Puan</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var seg in report.GetProperty("byAgeGroup").EnumerateArray())
                                {
                                    <tr>
                                        <td><span class="badge bg-primary">@seg.GetProperty("segment").GetString()</span></td>
                                        <td>@seg.GetProperty("userCount").GetInt32()</td>
                                        <td>@seg.GetProperty("attemptCount").GetInt32()</td>
                                        <td>@seg.GetProperty("averageScore").GetDouble().ToString("F1")</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- By Subscription Type -->
            <div class="col-md-6">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-white">
                        <h5 class="mb-0"><i class="bi bi-tags me-2"></i>Abonelik Tipine Gore</h5>
                    </div>
                    <div class="card-body">
                        <table class="table table-hover mb-0">
                            <thead>
                                <tr>
                                    <th>Segment</th>
                                    <th>Kullanici</th>
                                    <th>Deneme</th>
                                    <th>Ort. Puan</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var seg in report.GetProperty("bySubscription").EnumerateArray())
                                {
                                    <tr>
                                        <td><span class="badge bg-secondary">@seg.GetProperty("segment").GetString()</span></td>
                                        <td>@seg.GetProperty("userCount").GetInt32()</td>
                                        <td>@seg.GetProperty("attemptCount").GetInt32()</td>
                                        <td>@seg.GetProperty("averageScore").GetDouble().ToString("F1")</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    }
    else
    {
        <div class="alert alert-info text-center">
            <i class="bi bi-info-circle me-2"></i>Rapor verileri yuklenemedi.
        </div>
    }
</div>
